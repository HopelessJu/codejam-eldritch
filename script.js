'use strict'
// ________________BLUE CARDS_____________________//
const blue1 = './assets/MythicCards/blue/blue1.png';
const blue2 = './assets/MythicCards/blue/blue2.png';
const blue3 = './assets/MythicCards/blue/blue3.png';
const blue4 = './assets/MythicCards/blue/blue4.png';
const blue5 = './assets/MythicCards/blue/blue5.png';
const blue6 = './assets/MythicCards/blue/blue6.png';
const blue7 = './assets/MythicCards/blue/blue7.png';
const blue8 = './assets/MythicCards/blue/blue8.png';
const blue9 = './assets/MythicCards/blue/blue9.png';
const blue10 = './assets/MythicCards/blue/blue10.png';
const blue11 = './assets/MythicCards/blue/blue11.png';
const blue12 = './assets/MythicCards/blue/blue12.png';

//____________________BROWN CARDS______________________//
const brown1 = './assets/MythicCards/brown/brown1.png';
const brown2 = './assets/MythicCards/brown/brown2.png';
const brown3 = './assets/MythicCards/brown/brown3.png';
const brown4 = './assets/MythicCards/brown/brown4.png';
const brown5 = './assets/MythicCards/brown/brown5.png';
const brown6 = './assets/MythicCards/brown/brown6.png';
const brown7 = './assets/MythicCards/brown/brown7.png';
const brown8 = './assets/MythicCards/brown/brown8.png';
const brown9 = './assets/MythicCards/brown/brown9.png';
const brown10 = './assets/MythicCards/brown/brown10.png';
const brown11 = './assets/MythicCards/brown/brown11.png';
const brown12 = './assets/MythicCards/brown/brown12.png';
const brown13 = './assets/MythicCards/brown/brown13.png';
const brown14 = './assets/MythicCards/brown/brown14.png';
const brown15 = './assets/MythicCards/brown/brown15.png';
const brown16 = './assets/MythicCards/brown/brown16.png';
const brown17 = './assets/MythicCards/brown/brown17.png';
const brown18 = './assets/MythicCards/brown/brown18.png';
const brown19 = './assets/MythicCards/brown/brown19.png';
const brown20 = './assets/MythicCards/brown/brown20.png';
const brown21 = './assets/MythicCards/brown/brown21.png';

//_________________GREEN CARDS_____________________________//
const green1 = './assets/MythicCards/green/green1.png';
const green2 = './assets/MythicCards/green/green2.png';
const green3 = './assets/MythicCards/green/green3.png';
const green4 = './assets/MythicCards/green/green4.png';
const green5 = './assets/MythicCards/green/green5.png';
const green6 = './assets/MythicCards/green/green6.png';
const green7 = './assets/MythicCards/green/green7.png';
const green8 = './assets/MythicCards/green/green8.png';
const green9 = './assets/MythicCards/green/green9.png';
const green10 = './assets/MythicCards/green/green10.png';
const green11 = './assets/MythicCards/green/green11.png';
const green12 = './assets/MythicCards/green/green12.png';
const green13 = './assets/MythicCards/green/green13.png';
const green14 = './assets/MythicCards/green/green14.png';
const green15 = './assets/MythicCards/green/green15.png';
const green16 = './assets/MythicCards/green/green16.png';
const green17 = './assets/MythicCards/green/green17.png';
const green18 = './assets/MythicCards/green/green18.png';

//____BLUE_ARRAY____//
const blueCards = [
    {
        cardPath: blue1,
        difficulty: 'hard',
        cardColour: 'blue'
    },
    {
        cardPath: blue2,
        difficulty: 'hard',
        cardColour: 'blue'
    },
    {
        cardPath: blue3,
        difficulty: 'easy',
        cardColour: 'blue'
    },
    {
        cardPath: blue4,
        difficulty: 'easy',
        cardColour: 'blue'
    },
    {
        cardPath: blue5,
        difficulty: 'easy',
        cardColour: 'blue'
    },
    {
        cardPath: blue6,
        difficulty: 'hard',
        cardColour: 'blue'
    },
    {
        cardPath: blue7,
        difficulty: 'normal',
        cardColour: 'blue'
    },
    {
        cardPath: blue8,
        difficulty: 'hard',
        cardColour: 'blue'
    },
    {
        cardPath: blue9,
        difficulty: 'normal',
        cardColour: 'blue'
    },
    {
        cardPath: blue10,
        difficulty: 'easy',
        cardColour: 'blue'
    },
    {
        cardPath: blue11,
        difficulty: 'normal',
        cardColour: 'blue'
    },
    {
        cardPath: blue12,
        difficulty: 'normal',
        cardColour: 'blue'
    }
]

//________BROWN_ARRAY____//
const brownCards = [
    {
        cardPath: brown1,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown2,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown3,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown4,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown5,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown6,
        difficulty: 'hard',
        cardColour: 'brown'
    },
    {
        cardPath: brown7,
        difficulty: 'hard',
        cardColour: 'brown'
    },
    {
        cardPath: brown8,
        difficulty: 'hard',
        cardColour: 'brown'
    },
    {
        cardPath: brown9,
        difficulty: 'hard',
        cardColour: 'brown'
    },
    {
        cardPath: brown10,
        difficulty: 'hard',
        cardColour: 'brown'
    },
    {
        cardPath: brown11,
        difficulty: 'easy',
        cardColour: 'brown'
    },
    {
        cardPath: brown12,
        difficulty: 'easy',
        cardColour: 'brown'
    },
    {
        cardPath: brown13,
        difficulty: 'easy',
        cardColour: 'brown'
    },
    {
        cardPath: brown14,
        difficulty: 'easy',
        cardColour: 'brown'
    },
    {
        cardPath: brown15,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown16,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown17,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown18,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown19,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown20,
        difficulty: 'normal',
        cardColour: 'brown'
    },
    {
        cardPath: brown21,
        difficulty: 'easy',
        cardColour: 'brown'
    }
]

//________GREEN ARRAY________//
const greenCards = [
    {
        cardPath: green1,
        difficulty: 'easy',
        cardColour: 'green'
    },
    {
        cardPath: green2,
        difficulty: 'hard',
        cardColour: 'green'
    },
    {
        cardPath: green3,
        difficulty: 'hard',
        cardColour: 'green'
    },
    {
        cardPath: green4,
        difficulty: 'hard',
        cardColour: 'green'
    },
    {
        cardPath: green5,
        difficulty: 'hard',
        cardColour: 'green'
    },
    {
        cardPath: green6,
        difficulty: 'hard',
        cardColour: 'green'
    },
    {
        cardPath: green7,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green8,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green9,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green10,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green11,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green12,
        difficulty: 'easy',
        cardColour: 'green'
    },
    {
        cardPath: green13,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green14,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green15,
        difficulty: 'normal',
        cardColour: 'green'
    },
    {
        cardPath: green16,
        difficulty: 'easy',
        cardColour: 'green'
    },
    {
        cardPath: green17,
        difficulty: 'easy',
        cardColour: 'green'
    },
    {
        cardPath: green18,
        difficulty: 'easy',
        cardColour: 'green'
    }
]

const azathoth = document.querySelector('.azathoth_img');
const cthulhu = document.querySelector('.cthulhu_img');
const yogSothoth = document.querySelector('.yog_sothoth_img');
const shubNiggurath = document.querySelector('.shub_niggurath_img');
const ancients = document.querySelectorAll('.ancient_img');
const cardBack = document.querySelector('.card_back');
const cardFace = document.querySelector('.card_face');
const difficulties = document.querySelectorAll('.difficulty');
const shuffleButton = document.querySelector('.shuffle_btn');
const diffSE = document.querySelector('.super_easy');
const diffE = document.querySelector('.easy');
const diffN = document.querySelector('.normal');
const diffH = document.querySelector('.hard');
const diffSH = document.querySelector('.super_hard');

let currentDifficulty = '';
let stage = null;

const blueEasy = blueCards.filter(card => card.difficulty === 'easy');
const blueNormal = blueCards.filter(card => card.difficulty === 'normal');
const blueHard = blueCards.filter(card => card.difficulty === 'hard');
const brownEasy = brownCards.filter(card => card.difficulty === 'easy');
const brownNormal = brownCards.filter(card => card.difficulty === 'normal');
const brownHard = brownCards.filter(card => card.difficulty === 'hard');
const greenEasy = greenCards.filter(card => card.difficulty === 'easy');
const greenNormal = greenCards.filter(card => card.difficulty === 'normal');
const greenHard = greenCards.filter(card => card.difficulty === 'hard');

const firstStageGreenDot = document.querySelector('.first_stage_green');
const firstStageBrownDot = document.querySelector('.first_stage_brown');
const firstStageBlueDot = document.querySelector('.first_stage_blue');
const secondStageGreenDot = document.querySelector ('.second_stage_green');
const secondStageBrownDot = document.querySelector('.second_stage_brown');
const secondStageBlueDot = document.querySelector('.second_stage_blue');
const thirdStageGreenDot = document.querySelector ('.third_stage_green');
const thirdStageBrownDot = document.querySelector('.third_stage_brown');
const thirdStageBlueDot = document.querySelector('.third_stage_blue');

cardFace.style.opacity = "0"

let blueSet = [];
let greenSet = [];
let brownSet = [];
let finalDeck = [];
let cardIndex = 0;
let greenNum = [];
let brownNum = [];
let blueNum = [];
let sortedDeck = [];
   
function stageMap() {
    if(azathoth.classList.contains('ancient_active')) {
        stage = 
        {
            firstStage: {
                greenCards: 1,
                blueCards: 1,
                brownCards: 2,
            },
            secondStage: {
                greenCards: 2,
                blueCards: 1,
                brownCards: 3,
            },
            thirdStage: {
                greenCards: 2,
                blueCards: 0,
                brownCards: 4,
            },
        }
        
    }
    if(cthulhu.classList.contains('ancient_active')) {
        stage = 
            {
                firstStage: {
                    greenCards: 0,
                    blueCards: 2,
                    brownCards: 2,
                  },
                  secondStage: {
                    greenCards: 1,
                    blueCards: 0,
                    brownCards: 3,
                  },
                  thirdStage: {
                    greenCards: 3,
                    blueCards: 0,
                    brownCards: 4,
                },
            }
        
    }
    if(yogSothoth.classList.contains('ancient_active')) {
        stage = 
            {
                firstStage: {
                    greenCards: 0,
                    blueCards: 1,
                    brownCards: 2,
                  },
                  secondStage: {
                    greenCards: 2,
                    blueCards: 1,
                    brownCards: 3,
                  },
                  thirdStage: {
                    greenCards: 3,
                    blueCards: 0,
                    brownCards: 4,
                },
            }
        
    }
    if(shubNiggurath.classList.contains('ancient_active')) {
        stage = 
            {
                firstStage: {
                    greenCards: 1,
                    blueCards: 1,
                    brownCards: 2,
                  },
                  secondStage: {
                    greenCards: 3,
                    blueCards: 1,
                    brownCards: 2,
                  },
                  thirdStage: {
                    greenCards: 2,
                    blueCards: 0,
                    brownCards: 4,
                },
            }
        
    }

    firstStageGreenDot.innerHTML = stage.firstStage.greenCards;  
    firstStageBrownDot.innerHTML = stage.firstStage.brownCards;  
    firstStageBlueDot.innerHTML = stage.firstStage.blueCards;  
    secondStageBrownDot.innerHTML = stage.secondStage.brownCards;  
    secondStageGreenDot.innerHTML = stage.secondStage.greenCards;  
    secondStageBlueDot.innerHTML = stage.secondStage.blueCards;  
    thirdStageBrownDot.innerHTML = stage.thirdStage.brownCards;  
    thirdStageGreenDot.innerHTML = stage.thirdStage.greenCards;  
    thirdStageBlueDot.innerHTML = stage.thirdStage.blueCards;
};

[...difficulties].forEach(difficultyElem => difficultyElem.addEventListener('click', function(e) {
    currentDifficulty = e.target.classList[1];
}));

diffSE.addEventListener('click', function(){
    diffE.classList.remove('E');
    diffN.classList.remove('N');
    diffH.classList.remove('H');
    diffSH.classList.remove('SH');
    diffSE.classList.add('SE');

});

diffE.addEventListener('click', function(){
    diffSE.classList.remove('SE');
    diffN.classList.remove('N');
    diffH.classList.remove('H');
    diffSH.classList.remove('SH');
    diffE.classList.add('E');
});

diffN.addEventListener('click', function(){
    diffSE.classList.remove('SE');
    diffE.classList.remove('E');
    diffH.classList.remove('H');
    diffSH.classList.remove('SH');
    diffN.classList.add('N');
});

diffH.addEventListener('click', function(){
    diffSE.classList.remove('SE');
    diffN.classList.remove('N');
    diffE.classList.remove('E');
    diffSH.classList.remove('SH');
    diffH.classList.add('H');
});

diffSH.addEventListener('click', function(){
    diffSE.classList.remove('SE');
    diffN.classList.remove('N');
    diffE.classList.remove('E');
    diffH.classList.remove('H');
    diffSH.classList.add('SH');
});

shuffleButton.addEventListener('click', createDeck) 

function createDeck() {
    if(stage && currentDifficulty) {
        let newDeck = Object.keys(stage).reduce((acc, currentStage) => {
            Object.keys(stage[currentStage]).forEach(stageColor => {
                acc[stageColor] = (acc[stageColor] || 0) + stage[currentStage][stageColor];
            })
            return acc;
        }, {});

        if (currentDifficulty === 'super_easy') {
            blueSet = shuffle(blueEasy).slice(0, newDeck.blueCards);
            if (blueSet.length < newDeck.blueCards) {
                blueSet = shuffle(blueSet.concat((shuffle(blueNormal).slice(0, newDeck.blueCards - blueSet.length))));
            }
        }
        if (currentDifficulty === 'super_easy') {
            greenSet = shuffle(greenEasy).slice(0, newDeck.greenCards);
            if (greenSet.length < newDeck.greenCards) {
                greenSet = shuffle(greenSet.concat((shuffle(greenNormal).slice(0, newDeck.greenCards - greenSet.length))));
            }
        }
        if (currentDifficulty === 'super_easy') {
            brownSet = shuffle(brownEasy).slice(0, newDeck.brownCards);
            if (brownSet.length < newDeck.brownCards) {
                brownSet = shuffle(brownSet.concat((shuffle(brownNormal).slice(0, newDeck.brownCards - brownSet.length))));
            }
        }
        if (currentDifficulty === 'easy') {
            blueSet = shuffle(blueEasy.concat(blueNormal)).slice(0, newDeck.blueCards);
        }    
        if (currentDifficulty === 'easy') {
            greenSet = shuffle(greenEasy.concat(greenNormal)).slice(0, newDeck.greenCards); 
        }
        if (currentDifficulty === 'easy') {
            brownSet = shuffle(brownEasy.concat(brownNormal)).slice(0, newDeck.brownCards); 
        }

        if(currentDifficulty === 'normal') {
            blueSet = shuffle(blueEasy.concat(blueNormal).concat(blueHard)).slice(0, newDeck.blueCards);
            greenSet = shuffle(greenEasy.concat(greenNormal).concat(greenHard)).slice(0, newDeck.greenCards);
            brownSet = shuffle(brownEasy.concat(brownNormal).concat(brownHard)).slice(0, newDeck.brownCards);
        }

        if (currentDifficulty === 'hard') {
            blueSet = shuffle(blueHard.concat(blueNormal)).slice(0, newDeck.blueCards);
        }    
        if (currentDifficulty === 'hard') {
            greenSet = shuffle(greenHard.concat(greenNormal)).slice(0, newDeck.greenCards); 
        }
        if (currentDifficulty === 'hard') {
            brownSet = shuffle(brownHard.concat(brownNormal)).slice(0, newDeck.brownCards); 
        }

        if (currentDifficulty === 'super_hard') {
            blueSet = shuffle(blueHard).slice(0, newDeck.blueCards);
            if (blueSet.length < newDeck.blueCards) {
                blueSet = shuffle(blueSet.concat((shuffle(blueNormal).slice(0, newDeck.blueCards - blueSet.length))));
            }
        }
        if (currentDifficulty === 'super_hard') {
            greenSet = shuffle(greenHard).slice(0, newDeck.greenCards);
            if (greenSet.kength < newDeck.greenCards) {
                greenSet = shuffle(greenSet.concat((shuffle(greenNormal).slice(0, newDeck.greenCards - greenSet.length))));
            }
        }
        if (currentDifficulty === 'super_hard') {
            brownSet = shuffle(brownHard).slice(0, newDeck.brownCards);
            if (brownSet.length < newDeck.brownCards) {
                brownSet = shuffle(brownSet.concat((shuffle(brownNormal).slice(0, newDeck.brownCards - brownSet.length))));
            }
        }       
    } else {
        alert('Please choose difficulty and ancient!');
    }
    finalDeck = shuffle(blueSet.concat(greenSet).concat(brownSet));
    greenNum = finalDeck.filter(card => card.cardColour === 'green');
    brownNum = finalDeck.filter(card => card.cardColour === 'brown');
    blueNum = finalDeck.filter(card => card.cardColour === 'blue');    

    const cardsByStages = {};
    let blueFinalDeck = finalDeck.filter(card => card.cardColour === 'blue');
    let brownFinalDeck = finalDeck.filter(card => card.cardColour === 'brown');
    let greenFinalDeck = finalDeck.filter(card => card.cardColour === 'green');

    Object.keys(stage).forEach(currentStageName => {
        cardsByStages[currentStageName] = [];
        Object.keys(stage[currentStageName]).forEach(color => {
            for (let i = 0; i < stage[currentStageName][color]; i++) {
                if (color === 'blueCards') {
                    cardsByStages[currentStageName] = [...cardsByStages[currentStageName], blueFinalDeck.pop()]
                }
                if (color === 'brownCards') {
                    cardsByStages[currentStageName] = [...cardsByStages[currentStageName], brownFinalDeck.pop()]
                }
                if (color === 'greenCards') {
                    cardsByStages[currentStageName] = [...cardsByStages[currentStageName], greenFinalDeck.pop()]
                }     
            }
        })
    });

    Object.keys(cardsByStages).forEach(stage => {
        cardsByStages[stage] = shuffle(cardsByStages[stage]);
    });

    Object.keys(cardsByStages).forEach(stage => {
        sortedDeck = [...sortedDeck, ...cardsByStages[stage]];
    });
    console.log('cards for game', sortedDeck);
};

function shuffle(someArray) {
    return [...someArray].sort(() => Math.random() - 0.5);
}

ancients.forEach( (ancient) => {
    ancient.addEventListener('click', function() {
        ancients.forEach(ancient => ancient.classList.remove('ancient_active'));
        ancient.classList.add('ancient_active');
        stageMap();
    })
});

cardBack.addEventListener('click', function() {
    cardBack.classList.remove('deck_active');
    cardBack.classList.add('deck_active');
    cardFace.style.opacity = "1";

    if(sortedDeck.length && cardBack.classList.contains('deck_active')) { 
        let currentCard = sortedDeck[0];
        cardFace.src = currentCard.cardPath;
        if(currentCard.cardColour === 'green') {
            if (+firstStageGreenDot.innerHTML > 0) {
                firstStageGreenDot.innerHTML = +firstStageGreenDot.innerHTML - 1 ;
            } else if (+secondStageGreenDot.innerHTML > 0) {
                secondStageGreenDot.innerHTML = +secondStageGreenDot.innerHTML - 1 ;
            }  else if (+thirdStageGreenDot.innerHTML > 0) {
                thirdStageGreenDot.innerHTML = +thirdStageGreenDot.innerHTML - 1;
            }
        }

        if(currentCard.cardColour === 'blue') {
            if (+firstStageBlueDot.innerHTML > 0) {
                firstStageBlueDot.innerHTML = +firstStageBlueDot.innerHTML - 1 ;
            } else if (+ secondStageBlueDot.innerHTML > 0) {
                secondStageBlueDot.innerHTML = + secondStageBlueDot.innerHTML - 1 ;
            }  else if (+thirdStageBlueDot.innerHTML > 0) {
                thirdStageBlueDot.innerHTML = +thirdStageBlueDot.innerHTML - 1;
            }
        }

        if(currentCard.cardColour === 'brown') {
            if (+firstStageBrownDot.innerHTML > 0) {
                firstStageBrownDot.innerHTML = +firstStageBrownDot.innerHTML - 1 ;
            } else if (+secondStageBrownDot.innerHTML > 0) {
                secondStageBrownDot.innerHTML = +secondStageBrownDot.innerHTML - 1 ;
            } else if (+thirdStageBrownDot.innerHTML > 0) {
                thirdStageBrownDot.innerHTML = +thirdStageBrownDot.innerHTML - 1;
            }
        }
        sortedDeck.splice(0, 1);
        console.log('left cards', sortedDeck);  
    } else {
        cardFace.style.opacity = "0";
        stage = null;
        ancients.forEach(ancient => ancient.classList.remove('ancient_active'));
        cardFace.src = "";

    }  
});